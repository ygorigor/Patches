From 05cad3f74b850dc6f7aa257bcd9f3aa5b64535ce Mon Sep 17 00:00:00 2001
From: Thecrazyskull <anaskarbila@gmail.com>
Date: Fri, 10 Feb 2017 09:38:50 -0500
Subject: [PATCH] Launcher3: Double tap on home screen to turn off screen

Change-Id: I554c005d5e523aca0842c78a353686e86af1a7f2
Signed-off-by: Pranav Vashi <neobuddy89@gmail.com>
---
 AndroidManifest-common.xml                            |  1 +
 .../launcher3/touch/WorkspaceTouchListener.java       | 11 +++++++++++
 2 files changed, 12 insertions(+)

diff --git a/AndroidManifest-common.xml b/AndroidManifest-common.xml
index 0ddb79eb5f..691d27ea72 100644
--- a/AndroidManifest-common.xml
+++ b/AndroidManifest-common.xml
@@ -46,6 +46,7 @@
     <uses-permission android:name="android.permission.WAKEUP_SURFACE_FLINGER" />
     <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />
     <uses-permission android:name="android.permission.USE_BIOMETRIC" />
+    <uses-permission android:name="android.permission.DEVICE_POWER" />
 
     <!--
     Permissions required for read/write access to the workspace data. These permission name
diff --git a/src/com/android/launcher3/touch/WorkspaceTouchListener.java b/src/com/android/launcher3/touch/WorkspaceTouchListener.java
index 576f17616b..712fd3a3e4 100644
--- a/src/com/android/launcher3/touch/WorkspaceTouchListener.java
+++ b/src/com/android/launcher3/touch/WorkspaceTouchListener.java
@@ -28,8 +28,10 @@ import static com.android.launcher3.logging.StatsLogManager.LauncherEvent.LAUNCH
 import static com.android.launcher3.logging.StatsLogManager.LauncherEvent.LAUNCHER_SPLIT_SELECTION_EXIT_INTERRUPTED;
 import static com.android.launcher3.logging.StatsLogManager.LauncherEvent.LAUNCHER_WORKSPACE_LONGPRESS;
 
+import android.content.Context;
 import android.graphics.PointF;
 import android.graphics.Rect;
+import android.os.PowerManager;
 import android.view.GestureDetector;
 import android.view.HapticFeedbackConstants;
 import android.view.InputDevice;
@@ -74,6 +76,8 @@ public class WorkspaceTouchListener extends GestureDetector.SimpleOnGestureListe
 
     private int mLongPressState = STATE_CANCELLED;
 
+    private final PowerManager mPm;
+
     private final GestureDetector mGestureDetector;
 
     public WorkspaceTouchListener(Launcher launcher, Workspace<?> workspace) {
@@ -82,6 +86,7 @@ public class WorkspaceTouchListener extends GestureDetector.SimpleOnGestureListe
         // Use twice the touch slop as we are looking for long press which is more
         // likely to cause movement.
         mTouchSlop = 2 * ViewConfiguration.get(launcher).getScaledTouchSlop();
+        mPm = (PowerManager) workspace.getContext().getSystemService(Context.POWER_SERVICE);
         mGestureDetector = new GestureDetector(workspace.getContext(), this);
     }
 
@@ -220,4 +225,10 @@ public class WorkspaceTouchListener extends GestureDetector.SimpleOnGestureListe
             }
         }
     }
+
+    @Override
+    public boolean onDoubleTap(MotionEvent event) {
+        mPm.goToSleep(event.getEventTime());
+        return true;
+    }
 }
-- 
2.51.2.windows.1

