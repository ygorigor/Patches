From ced3eb6fc7cc617b6893b1a35a362e5fa0eb5669 Mon Sep 17 00:00:00 2001
From: Anushek Prasal <anushekprasal@gmail.com>
Date: Wed, 29 May 2019 01:26:35 +0530
Subject: [PATCH] base: Use wireless charging animation for wired charging too

Signed-off-by: Pranav Vashi <neobuddy89@gmail.com>
---
 .../java/com/android/server/power/Notifier.java    | 14 ++++++++++----
 .../android/server/power/PowerManagerService.java  |  2 +-
 2 files changed, 11 insertions(+), 5 deletions(-)

diff --git a/services/core/java/com/android/server/power/Notifier.java b/services/core/java/com/android/server/power/Notifier.java
index f9cecfe80b0c..08efedea906b 100644
--- a/services/core/java/com/android/server/power/Notifier.java
+++ b/services/core/java/com/android/server/power/Notifier.java
@@ -949,7 +949,7 @@ public class Notifier {
     /**
      * Called when wired charging has started - to provide user feedback
      */
-    public void onWiredChargingStarted(@UserIdInt int userId) {
+    public void onWiredChargingStarted(int batteryLevel, @UserIdInt int userId) {
         if (DEBUG) {
             Slog.d(TAG, "onWiredChargingStarted");
         }
@@ -957,7 +957,8 @@ public class Notifier {
         mSuspendBlocker.acquire();
         Message msg = mHandler.obtainMessage(MSG_WIRED_CHARGING_STARTED);
         msg.setAsynchronous(true);
-        msg.arg1 = userId;
+        msg.arg1 = batteryLevel;
+        msg.arg2 = userId;
         mHandler.sendMessage(msg);
     }
 
@@ -1218,8 +1219,13 @@ public class Notifier {
         mSuspendBlocker.release();
     }
 
-    private void showWiredChargingStarted(@UserIdInt int userId) {
+    private void showWiredChargingStarted(int batteryLevel, @UserIdInt int userId) {
         playChargingStartedFeedback(userId, false /* wireless */);
+
+        // show animation
+        if (mStatusBarManagerInternal != null) {
+            mStatusBarManagerInternal.showChargingAnimation(batteryLevel);
+        }
         mSuspendBlocker.release();
     }
 
@@ -1526,7 +1532,7 @@ public class Notifier {
                     showChargingStopped(msg.arg1, false /* wireless */);
                     break;
                 case MSG_WIRED_CHARGING_STARTED:
-                    showWiredChargingStarted(msg.arg1);
+                    showWiredChargingStarted(msg.arg1, msg.arg2);
                     break;
                 case MSG_SCREEN_POLICY:
                     screenPolicyChanging(msg.arg1, msg.arg2);
diff --git a/services/core/java/com/android/server/power/PowerManagerService.java b/services/core/java/com/android/server/power/PowerManagerService.java
index bda7b0b986b4..f4b61061e095 100644
--- a/services/core/java/com/android/server/power/PowerManagerService.java
+++ b/services/core/java/com/android/server/power/PowerManagerService.java
@@ -2852,7 +2852,7 @@ public final class PowerManagerService extends SystemService
                 if (mBootCompleted) {
                     if (mIsPowered && !BatteryManager.isPlugWired(oldPlugType)
                             && BatteryManager.isPlugWired(mPlugType)) {
-                        mNotifier.onWiredChargingStarted(mUserId);
+                        mNotifier.onWiredChargingStarted(mBatteryLevel, mUserId);
                     } else if (wasPowered && !mIsPowered) {
                         if (oldPlugType == BatteryManager.BATTERY_PLUGGED_WIRELESS) {
                             mNotifier.onWirelessChargingInterrupted(mUserId);
-- 
2.51.2.windows.1

